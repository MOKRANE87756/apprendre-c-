// Project: EMS React + JWT (Vite)
// Files included below. Create these files in a project folder to run.

/* === package.json ===
{
  "name": "ems-react-jwt",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "server": "node server/index.js"
  },
  "dependencies": {
    "axios": "^1.4.0",
    "jwt-decode": "^3.1.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.14.1"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.0.0",
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.24",
    "tailwindcss": "^4.0.0",
    "vite": "^5.0.0"
  }
}
*/

/* === vite.config.jsx === */
// import { defineConfig } from 'vite'
// import react from '@vitejs/plugin-react'
// export default defineConfig({ plugins:[react()] })

/* === tailwind.config.cjs === */
// module.exports = { content: ['./index.html','./src/**/*.{js,jsx}'], theme:{extend:{}}, plugins:[] }

/* === postcss.config.cjs === */
// module.exports = { plugins: { tailwindcss: {}, autoprefixer: {} } }

/* === index.html === */
// <!doctype html>
// <html lang="ar" dir="rtl">
// <head>
// <meta charset="utf-8" />
// <meta name="viewport" content="width=device-width,initial-scale=1" />
// <title>EMS React — Login</title>
// </head>
// <body>
// <div id="root"></div>
// <script type="module" src="/src/main.jsx"></script>
// </body>
// </html>

/* === src/main.jsx === */
import React from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom'
import App from './pages/App'
import Dashboard from './pages/Dashboard'
import './styles/tailwind.css'
import { AuthProvider, useAuth } from './lib/auth'

function Protected({ children }){
  const { token, loading } = useAuth();
  if(loading) return <div className="p-6">جارٍ التحقق...</div>
  return token ? children : <Navigate to="/" replace />
}

createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <AuthProvider>
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<App/>} />
          <Route path="/dashboard" element={<Protected><Dashboard/></Protected>} />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  </React.StrictMode>
)

/* === src/pages/App.jsx === */
import React, {useState} from 'react'
import LoginCard from '../ui/LoginCard'

export default function App(){
  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6">
      <LoginCard />
    </div>
  )
}

/* === src/ui/LoginCard.jsx === */
import React, {useState} from 'react'
import { useAuth } from '../lib/auth'

export default function LoginCard(){
  const { login, demo } = useAuth();
  const [username,setUsername] = useState('')
  const [password,setPassword] = useState('')
  const [err,setErr] = useState(null)

  async function onSubmit(e){
    e.preventDefault(); setErr(null)
    try{ await login(username, password) } catch(er){ setErr(er.message || 'خطأ في تسجيل الدخول') }
  }

  return (
    <div className="max-w-4xl w-full bg-white shadow-md rounded-2xl grid grid-cols-1 md:grid-cols-2 overflow-hidden">
      <div className="p-8">
        <div className="flex items-center gap-4 mb-6">
          <div className="w-16 h-16 rounded-lg bg-gradient-to-br from-blue-700 to-blue-400 flex items-center justify-center text-white font-bold">FAF</div>
          <div>
            <div className="font-bold">الفدرالية الجزائرية لكرة القدم</div>
            <div className="text-sm text-slate-500">منصة EMS — ورقة المباراة الإلكترونية</div>
          </div>
        </div>
        <h2 className="text-2xl font-semibold text-slate-800">أهلاً بك</h2>
        <p className="text-sm text-slate-500 mt-2">قم بتسجيل الدخول للوصول إلى لوحة التحكم وإدارة المباريات.</p>
        <ul className="mt-6 space-y-3 text-sm text-slate-600">
          <li>• إدارة الفرق والطاقم</li>
          <li>• حفظ تلقائي وتصدير إلى PDF</li>
          <li>• نظام صلاحيات آمن</li>
        </ul>
        <div className="text-xs text-slate-400 mt-6">جميع الحقوق محفوظة © 2025</div>
      </div>

      <div className="p-8 bg-slate-50">
        <form onSubmit={onSubmit} className="space-y-4">
          {err && <div className="text-sm text-red-600">{err}</div>}
          <div>
            <label className="block text-sm text-slate-600">اسم المستخدم</label>
            <input value={username} onChange={e=>setUsername(e.target.value)} className="w-full mt-2 p-3 rounded-lg border" placeholder="club123" />
          </div>
          <div>
            <label className="block text-sm text-slate-600">كلمة المرور</label>
            <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full mt-2 p-3 rounded-lg border" placeholder="••••••••" />
          </div>
          <div className="flex gap-3">
            <button className="flex-1 p-3 rounded-lg bg-blue-700 text-white" type="submit">تسجيل الدخول</button>
            <button type="button" onClick={demo} className="p-3 rounded-lg border">تجريبي</button>
          </div>
          <div className="flex justify-between text-xs text-slate-500">
            <a href="#">نسيت كلمة المرور؟</a>
            <span>إصدار 2025</span>
          </div>
        </form>
      </div>
    </div>
  )
}

/* === src/pages/Dashboard.jsx === */
import React from 'react'
import { useAuth } from '../lib/auth'
export default function Dashboard(){
  const { logout, user } = useAuth();
  return (
    <div className="min-h-screen p-8 bg-slate-50">
      <div className="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow"> 
        <div className="flex justify-between items-center mb-6">
          <h1 className="font-bold">لوحة التحكم</h1>
          <div className="flex gap-3 items-center">
            <div className="text-sm text-slate-600">مرحباً، {user?.name || user?.username}</div>
            <button onClick={logout} className="text-sm px-3 py-2 border rounded">تسجيل خروج</button>
          </div>
        </div>
        <div>محتوى لوحة التحكم (مثال)</div>
      </div>
    </div>
  )
}

/* === src/lib/auth.jsx === */
import React, {createContext, useContext, useState, useEffect} from 'react'
import axios from 'axios'
import jwtDecode from 'jwt-decode'

const AuthContext = createContext(null)

export function AuthProvider({children}){
  const auth = useProvideAuth()
  return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>
}
export const useAuth = () => useContext(AuthContext)

function useProvideAuth(){
  const [token,setToken] = useState(()=> localStorage.getItem('ems_token'))
  const [user,setUser] = useState(()=> token ? jwtDecode(token) : null)
  const [loading,setLoading] = useState(true)

  useEffect(()=>{
    // عند تحميل التطبيق، حاول التحقق من الجلسة إن وُجدت توكن
    async function check(){
      if(!token){ setLoading(false); return }
      try{
        // خيار: تحقق من السيرفر إن أردت
        const res = await axios.get('/api/auth/check',{ headers: { Authorization: `Bearer ${token}` } })
        setUser(res.data.user || jwtDecode(token))
      } catch(err){
        console.warn('session invalid', err)
        setToken(null); localStorage.removeItem('ems_token'); setUser(null)
      } finally{ setLoading(false) }
    }
    check()
  }, [])

  async function login(username,password){
    const res = await axios.post('/server/api/login',{ username, password })
    if(res.status === 200 && res.data?.token){
      localStorage.setItem('ems_token', res.data.token)
      setToken(res.data.token)
      setUser(jwtDecode(res.data.token))
    } else {
      throw new Error(res.data?.message || 'فشل تسجيل الدخول')
    }
  }

  function demo(){
    // بيانات تجريبية (محليًا)
    const token = 'eyJhbGciOi...demo' // placeholder
    localStorage.setItem('ems_token', token)
    setToken(token)
    setUser({ username: 'demo_club', name:'نادي تجريبي' })
  }

  function logout(){
    localStorage.removeItem('ems_token'); setToken(null); setUser(null)
  }

  return { token, user, loading, login, logout, demo }
}

/* === server/index.js === */
// Simple example server (Express) that issues JWT. This is for local development only.
// Run with: node server/index.js

/*
const express = require('express')
const jwt = require('jsonwebtoken')
const bodyParser = require('body-parser')
const cors = require('cors')

const app = express()
app.use(cors({ origin: ['http://localhost:5173'], credentials: true }))
app.use(bodyParser.json())

const SECRET = 'replace_this_with_a_strong_secret'

app.post('/server/api/login', (req,res)=>{
  const { username, password } = req.body
  // مثال تحقق بسيط — غيّر مع منطقك
  if(username === 'demo_club' && password === 'demo1234'){
    const payload = { username: 'demo_club', name: 'نادي تجريبي' }
    const token = jwt.sign(payload, SECRET, { expiresIn: '2h' })
    return res.json({ token })
  }
  // هنا تضع التحقق من قاعدة البيانات
  return res.status(401).json({ message: 'بيانات اعتماد غير صحيحة' })
})

app.get('/server/api/check', (req,res)=>{
  const auth = req.headers.authorization
  if(!auth) return res.status(401).json({ message: 'مفقود' })
  const token = auth.replace('Bearer ','')
  try{
    const payload = jwt.verify(token, SECRET)
    return res.json({ ok:true, user: payload })
  } catch(err){ return res.status(401).json({ message: 'توكين غير صالح' }) }
})

app.listen(4000, ()=>console.log('API server listening on http://localhost:4000'))
*/

/* === README.md (مختصر) ===
1) تثبيت:
   npm install
2) تشغيل الواجهة:
   npm run dev
3) تشغيل السيرفر التجريبي:
   npm run server

ملاحظات أمان:
- للإنتاج استعمل httpOnly cookies للـ JWT أو نظام refresh tokens.
- استعمل سر قوي وقيّم صلاحية التوكن.
- لا تخزن توكن طويل الأمد في localStorage للبيئات الحساسة.
*/

/* === styles/tailwind.css === */
// @tailwind base;
// @tailwind components;
// @tailwind utilities;

/* === إضافات & ملاحظات نهائية ===
- يحتوي المشروع واجهة تسجيل دخول احترافية، دعم demo، وملف سيرفر نموذجي يصدر JWT.
- لتحويل المشروع إلى Next.js: انقل الصفحات إلى /pages، واستعمل API routes في /pages/api لتوليد التوكن، واستخدم getServerSideProps أو middleware لحماية الصفحات.
- لتجهيز ZIP: ضع كل الملفات أعلاه في مجلد، ثم نفّذ zip -r ems-react-jwt.zip .

إذا رغبت، أستطيع الآن:
1) توليد مشروع Next.js بدل Vite React (أقوم به مباشرة). 
2) إنشاء ملف zip داخل المساحة وإتاحة رابط تحميل. 
3) إعادة بناء واجهة بواجهة عربية متكاملة مع Dark/Light toggle.

اخبرني أي خيار تريده الآن وسأنفذه فورًا.
*/
